openapi: 3.0.3
info:
  title: Lagos Service Hub API
  version: 1.0.0
  description: >
    OpenAPI 3.0 specification for Lagos Service Hub. This API supports
    authentication, seller onboarding, job lifecycle management, escrow payments,
    chat, admin oversight, and user profile management. All location fields are
    constrained to Lagos (state and city must equal "Lagos"). Escrow flow enforces
    a 70% deposit and a 10% platform commission. Protected endpoints require
    Bearer JWT. Rate limiting applies to all endpoints and is documented per route
    via vendor extension x-rateLimit.
servers:
  - url: https://api.lagosservicehub.ng
    description: Production
  - url: http://localhost:3000
    description: Local development
security:
  - bearerAuth: []
tags:
  - name: Authentication
  - name: Sellers
  - name: Jobs
  - name: Payments
  - name: Chats
  - name: Admin
  - name: Users
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number (1-based)
    LimitParam:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      description: Items per page (max 100)
    QParam:
      name: q
      in: query
      required: false
      schema:
        type: string
        maxLength: 200
      description: Search query string
    CategoryParam:
      name: category
      in: query
      required: false
      schema:
        type: string
      description: Service category filter (e.g., electrical, plumbing)
    StatusParam:
      name: status
      in: query
      required: false
      schema:
        $ref: '#/components/schemas/JobStatusEnum'
      description: Job status filter
  schemas:
    Error:
      type: object
      properties:
        code:
          type: string
          example: VALIDATION_ERROR
        message:
          type: string
          example: Invalid input
        details:
          type: array
          items:
            type: string
      required: [code, message]
    PageMeta:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 125
        hasNext:
          type: boolean
          example: true
        hasPrev:
          type: boolean
          example: false
      required: [page, limit, total]
    AuthTokens:
      type: object
      properties:
        tokenType:
          type: string
          example: Bearer
        accessToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          example: r1.a.b.c
        expiresIn:
          type: integer
          description: Access token TTL in seconds
          example: 3600
      required: [tokenType, accessToken, refreshToken, expiresIn]
    UserRoleEnum:
      type: string
      enum: [buyer, seller, admin]
    ThemePreferenceEnum:
      type: string
      enum: [light, dark, midnight, warm-night, ocean-breeze, sunset-gold]
    VerificationStatusEnum:
      type: string
      enum: [pending, verified, rejected, suspended]
    JobStatusEnum:
      type: string
      enum: [proposed, funded, in_progress, partial_completed, completed, cancelled, disputed]
    TransactionTypeEnum:
      type: string
      enum: [ESCROW_DEPOSIT, PAYOUT, REFUND, COMMISSION]
    TransactionStatusEnum:
      type: string
      enum: [PENDING, CONFIRMED, FAILED]
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        phone:
          type: string
        role:
          $ref: '#/components/schemas/UserRoleEnum'
        firstName:
          type: string
        lastName:
          type: string
        state:
          type: string
          enum: [Lagos]
        city:
          type: string
          enum: [Lagos]
        address:
          type: string
        themePreference:
          $ref: '#/components/schemas/ThemePreferenceEnum'
        isActive:
          type: boolean
          default: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, email, role, firstName, lastName, state, city, themePreference, createdAt, updatedAt]
      example:
        id: 8c5b2b7d-10c7-4dc2-8c78-55a0bbf3a019
        email: buyer1@lagosservicehub.ng
        role: buyer
        firstName: Bola
        lastName: Ade
        state: Lagos
        city: Lagos
        themePreference: ocean-breeze
        isActive: true
        createdAt: 2026-01-08T09:35:12Z
        updatedAt: 2026-01-08T09:35:12Z
    SellerProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        displayName:
          type: string
        bio:
          type: string
        categories:
          type: array
          items:
            type: string
        yearsExperience:
          type: integer
          minimum: 0
        idDocumentUrl:
          type: string
        portfolioUrl:
          type: string
        verificationStatus:
          $ref: '#/components/schemas/VerificationStatusEnum'
        ratingAverage:
          type: number
          format: float
          minimum: 0
          maximum: 5
        ratingCount:
          type: integer
          minimum: 0
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, userId, displayName, categories, verificationStatus, createdAt, updatedAt]
    Job:
      type: object
      properties:
        id:
          type: string
          format: uuid
        buyerId:
          type: string
          format: uuid
        sellerId:
          type: string
          format: uuid
        sellerProfileId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        category:
          type: string
        status:
          $ref: '#/components/schemas/JobStatusEnum'
        state:
          type: string
          enum: [Lagos]
        city:
          type: string
          enum: [Lagos]
        address:
          type: string
        quotedAmount:
          type: number
          format: float
          minimum: 0
        agreedAmount:
          type: number
          format: float
          minimum: 0
        depositPercentage:
          type: number
          format: float
          description: Must equal 70.00 (70% deposit)
          default: 70.0
        commissionPercentage:
          type: number
          format: float
          description: Must equal 10.00 (10% platform commission)
          default: 10.0
        fundedAt:
          type: string
          format: date-time
        startedAt:
          type: string
          format: date-time
        partialCompletedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        disputedAt:
          type: string
          format: date-time
        dueDate:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, buyerId, sellerId, sellerProfileId, title, category, status, state, city, quotedAmount, createdAt, updatedAt]
      example:
        id: 2c3c1c87-2f8b-4e49-8a74-a4f1cf39b3a4
        buyerId: 8c5b2b7d-10c7-4dc2-8c78-55a0bbf3a019
        sellerId: e0b54f26-7e0c-4e8a-bb7e-4b79b2e1cc4a
        sellerProfileId: 7bff0324-3b9e-41b2-9b7f-2e43d08d7a61
        title: Fix wiring issue
        category: electrical
        status: funded
        state: Lagos
        city: Lagos
        quotedAmount: 50000
        agreedAmount: 50000
        depositPercentage: 70.0
        commissionPercentage: 10.0
        fundedAt: 2026-01-08T10:00:00Z
        createdAt: 2026-01-08T09:50:00Z
        updatedAt: 2026-01-08T10:00:00Z
    PaymentTransaction:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        buyerId:
          type: string
          format: uuid
        sellerId:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/TransactionTypeEnum'
        status:
          $ref: '#/components/schemas/TransactionStatusEnum'
        amount:
          type: number
          format: float
          minimum: 0
        currency:
          type: string
          default: NGN
        paystackReference:
          type: string
        idempotencyKey:
          type: string
        commissionAmount:
          type: number
          format: float
          minimum: 0
        escrowAmount:
          type: number
          format: float
          minimum: 0
        releasedAmount:
          type: number
          format: float
          minimum: 0
        releasedAt:
          type: string
          format: date-time
        releasedBy:
          type: string
          format: uuid
        metadata:
          type: object
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, jobId, type, status, amount, currency, idempotencyKey, createdAt, updatedAt]
    ChatMessage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        senderId:
          type: string
          format: uuid
        recipientId:
          type: string
          format: uuid
        content:
          type: string
        attachments:
          type: array
          items:
            type: object
        deliveredAt:
          type: string
          format: date-time
        readAt:
          type: string
          format: date-time
        isDeleted:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, jobId, senderId, recipientId, content, createdAt]
    AuditLog:
      type: object
      properties:
        id:
          type: string
          format: uuid
        actorId:
          type: string
          format: uuid
        targetType:
          type: string
        targetId:
          type: string
          format: uuid
        action:
          type: string
        metadata:
          type: object
        ipAddress:
          type: string
          format: ipv4
        userAgent:
          type: string
        createdAt:
          type: string
          format: date-time
      required: [id, targetType, targetId, action, createdAt]
    RegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        phone:
          type: string
        password:
          type: string
          minLength: 8
        role:
          type: string
          enum: [buyer, seller]
        firstName:
          type: string
        lastName:
          type: string
        state:
          type: string
          enum: [Lagos]
        city:
          type: string
          enum: [Lagos]
        address:
          type: string
        themePreference:
          $ref: '#/components/schemas/ThemePreferenceEnum'
      required: [email, password, role, firstName, lastName, state, city]
      example:
        email: buyer1@lagosservicehub.ng
        password: StrongPass#123
        role: buyer
        firstName: Bola
        lastName: Ade
        state: Lagos
        city: Lagos
        themePreference: sunset-gold
    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
      required: [email, password]
      example:
        email: buyer1@lagosservicehub.ng
        password: StrongPass#123
    RefreshRequest:
      type: object
      properties:
        refreshToken:
          type: string
      required: [refreshToken]
      example:
        refreshToken: r1.a.b.c
    SellerUpsertRequest:
      type: object
      properties:
        displayName:
          type: string
        bio:
          type: string
        categories:
          type: array
          items:
            type: string
        yearsExperience:
          type: integer
          minimum: 0
        portfolioUrl:
          type: string
      required: [displayName, categories]
      example:
        displayName: Tunde Electrics
        bio: Experienced electrician in Ikeja
        categories: [electrical, maintenance]
        yearsExperience: 5
        portfolioUrl: https://cdn.lsh.ng/portfolios/tunde
    PortfolioUploadResponse:
      type: object
      properties:
        urls:
          type: array
          items:
            type: string
      example:
        urls:
          - https://cdn.lsh.ng/portfolio/uuid1.jpg
          - https://cdn.lsh.ng/portfolio/uuid2.jpg
    IDDocumentUploadResponse:
      type: object
      properties:
        idDocumentUrl:
          type: string
        verificationStatus:
          $ref: '#/components/schemas/VerificationStatusEnum'
      example:
        idDocumentUrl: https://cdn.lsh.ng/id/seller-uuid.pdf
        verificationStatus: pending
    JobCreateRequest:
      type: object
      properties:
        sellerProfileId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        category:
          type: string
        quotedAmount:
          type: number
          format: float
          minimum: 0
        agreedAmount:
          type: number
          format: float
          minimum: 0
        state:
          type: string
          enum: [Lagos]
        city:
          type: string
          enum: [Lagos]
        address:
          type: string
      required: [sellerProfileId, title, category, quotedAmount, state, city]
      example:
        sellerProfileId: 7bff0324-3b9e-41b2-9b7f-2e43d08d7a61
        title: Fix wiring issue
        description: Living room lights flicker
        category: electrical
        quotedAmount: 50000
        agreedAmount: 50000
        state: Lagos
        city: Lagos
        address: 10 Allen Avenue, Ikeja
    JobStatusUpdateRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/JobStatusEnum'
      required: [status]
      example:
        status: in_progress
      description: Allowed transitions — proposed→funded; funded→in_progress; in_progress→partial_completed→completed; any→disputed/cancelled (admin oversight).
    SatisfactionReportRequest:
      type: object
      properties:
        completionPercent:
          type: integer
          minimum: 50
          maximum: 100
        comments:
          type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5
      required: [completionPercent]
      example:
        completionPercent: 60
        comments: Work is at least half done; proceed to release escrow.
        rating: 5
    PaymentInitializeRequest:
      type: object
      properties:
        jobId:
          type: string
          format: uuid
        amount:
          type: number
          format: float
          description: >
            Must equal 70% of job.agreedAmount. Server will validate and may
            compute automatically.
      required: [jobId, amount]
      example:
        jobId: 2c3c1c87-2f8b-4e49-8a74-a4f1cf39b3a4
        amount: 35000
    PaymentInitializeResponse:
      type: object
      properties:
        authorizationUrl:
          type: string
        reference:
          type: string
        accessCode:
          type: string
      required: [authorizationUrl, reference]
      example:
        authorizationUrl: https://checkout.paystack.com/abcdef
        reference: ps_ref_12345
        accessCode: ACCESSCODE123
    PaystackWebhookRequest:
      type: object
      properties:
        event:
          type: string
          example: charge.success
        data:
          type: object
      required: [event, data]
    PaymentVerifyResponse:
      type: object
      properties:
        reference:
          type: string
        status:
          type: string
          enum: [success, pending, failed]
        transaction:
          $ref: '#/components/schemas/PaymentTransaction'
      required: [reference, status]
    MessageCreateRequest:
      type: object
      properties:
        content:
          type: string
        attachments:
          type: array
          items:
            type: object
      required: [content]
      example:
        content: Hi, please confirm visit time
paths:
  /v1/auth/register:
    post:
      tags: [Authentication]
      summary: Buyer or seller registration
      description: Registers a new user. Location is Lagos-only. Role must be buyer or seller.
      security: []
      x-rateLimit:
        limit: 10
        window: 60s
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/auth/login:
    post:
      tags: [Authentication]
      summary: Login with email and password
      security: []
      x-rateLimit:
        limit: 30
        window: 60s
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokens'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/auth/refresh:
    post:
      tags: [Authentication]
      summary: Refresh access token
      security: []
      x-rateLimit:
        limit: 60
        window: 60s
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokens'
        '401':
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/auth/logout:
    post:
      tags: [Authentication]
      summary: Logout current user (revoke tokens)
      x-rateLimit:
        limit: 60
        window: 60s
      responses:
        '204':
          description: Logged out
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/auth/me:
    get:
      tags: [Authentication]
      summary: Get current user
      x-rateLimit:
        limit: 60
        window: 60s
      responses:
        '200':
          description: Current user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/sellers:
    get:
      tags: [Sellers]
      summary: List sellers with filters
      x-rateLimit:
        limit: 120
        window: 60s
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/QParam'
        - $ref: '#/components/parameters/CategoryParam'
        - name: ratingMin
          in: query
          schema:
            type: number
            minimum: 0
            maximum: 5
        - name: location
          in: query
          schema:
            type: string
            enum: [Lagos]
      responses:
        '200':
          description: Seller list
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/SellerProfile'
                  meta:
                    $ref: '#/components/schemas/PageMeta'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags: [Sellers]
      summary: Create or update seller profile (seller only)
      x-rateLimit:
        limit: 30
        window: 60s
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SellerUpsertRequest'
      responses:
        '201':
          description: Seller profile created/updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SellerProfile'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (role not seller)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/sellers/{id}:
    get:
      tags: [Sellers]
      summary: Get public seller profile
      x-rateLimit:
        limit: 120
        window: 60s
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Seller profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SellerProfile'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/sellers/portfolio:
    post:
      tags: [Sellers]
      summary: Upload seller portfolio images
      x-rateLimit:
        limit: 20
        window: 60s
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
              required: [files]
      responses:
        '201':
          description: Portfolio uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PortfolioUploadResponse'
        '400':
          description: Validation error (size/type)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/sellers/id-document:
    post:
      tags: [Sellers]
      summary: Upload seller ID document for verification
      x-rateLimit:
        limit: 10
        window: 60s
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required: [file]
      responses:
        '201':
          description: ID document uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IDDocumentUploadResponse'
        '400':
          description: Validation error (size/type)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/sellers/me:
    get:
      tags: [Sellers]
      summary: Seller dashboard data
      x-rateLimit:
        limit: 60
        window: 60s
      responses:
        '200':
          description: Seller profile and KPIs
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    $ref: '#/components/schemas/SellerProfile'
                  stats:
                    type: object
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/jobs:
    post:
      tags: [Jobs]
      summary: Create job agreement (buyer initiates)
      x-rateLimit:
        limit: 30
        window: 60s
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobCreateRequest'
      responses:
        '201':
          description: Job created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      tags: [Jobs]
      summary: List user's jobs (buyer or seller view)
      x-rateLimit:
        limit: 120
        window: 60s
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/StatusParam'
        - name: roleView
          in: query
          schema:
            type: string
            enum: [buyer, seller]
      responses:
        '200':
          description: Job list
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
                  meta:
                    $ref: '#/components/schemas/PageMeta'
  /v1/jobs/{id}:
    get:
      tags: [Jobs]
      summary: Job details
      x-rateLimit:
        limit: 120
        window: 60s
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/jobs/{id}/status:
    patch:
      tags: [Jobs]
      summary: Update job status
      x-rateLimit:
        limit: 30
        window: 60s
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobStatusUpdateRequest'
      responses:
        '200':
          description: Status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '400':
          description: Invalid transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/jobs/{id}/satisfaction:
    post:
      tags: [Jobs]
      summary: Buyer submits satisfaction report (>=50% completion)
      x-rateLimit:
        limit: 20
        window: 60s
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SatisfactionReportRequest'
      responses:
        '201':
          description: Report submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  job:
                    $ref: '#/components/schemas/Job'
                  nextAction:
                    type: string
                    example: Awaiting admin review for escrow release
        '400':
          description: Validation error (<50%)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/payments/initialize:
    post:
      tags: [Payments]
      summary: Start Paystack payment for job (70% deposit)
      x-rateLimit:
        limit: 20
        window: 60s
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentInitializeRequest'
      responses:
        '201':
          description: Payment initialized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentInitializeResponse'
        '400':
          description: Validation error (amount != 70% agreed)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/payments/webhook:
    post:
      tags: [Payments]
      summary: Paystack webhook (HMAC verification, idempotent)
      security: []
      x-rateLimit:
        limit: 300
        window: 60s
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaystackWebhookRequest'
      responses:
        '200':
          description: Webhook processed
        '400':
          description: Invalid signature/payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/payments/verify/{reference}:
    get:
      tags: [Payments]
      summary: Verify payment status
      x-rateLimit:
        limit: 60
        window: 60s
      parameters:
        - name: reference
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Payment verification
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentVerifyResponse'
        '404':
          description: Reference not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/chats/jobs/{jobId}/messages:
    get:
      tags: [Chats]
      summary: Get chat history for job
      x-rateLimit:
        limit: 120
        window: 60s
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Chat messages
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ChatMessage'
                  meta:
                    $ref: '#/components/schemas/PageMeta'
    post:
      tags: [Chats]
      summary: Send message (also via WebSocket)
      x-rateLimit:
        limit: 60
        window: 60s
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageCreateRequest'
      responses:
        '201':
          description: Message created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatMessage'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/ws/chat:
    get:
      tags: [Chats]
      summary: WebSocket connection for real-time messaging
      description: >
        Upgrades HTTP to WebSocket at /v1/ws/chat. Clients must send an initial
        auth message with Bearer token. Supported actions: join_job, send_message.
      x-websocket:
        protocol: ws
        auth: Bearer JWT via initial message {type:"auth", token:"..."}
        messages:
          - name: join_job
            example:
              type: join_job
              jobId: 2c3c1c87-2f8b-4e49-8a74-a4f1cf39b3a4
          - name: send_message
            example:
              type: send_message
              jobId: 2c3c1c87-2f8b-4e49-8a74-a4f1cf39b3a4
              content: Hello
      responses:
        '101':
          description: Switching Protocols
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/admin/verifications:
    get:
      tags: [Admin]
      summary: Pending seller verifications
      x-rateLimit:
        limit: 60
        window: 60s
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Pending verifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/SellerProfile'
                  meta:
                    $ref: '#/components/schemas/PageMeta'
        '403':
          description: Admin only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/admin/verifications/{sellerId}/approve:
    post:
      tags: [Admin]
      summary: Approve seller verification
      x-rateLimit:
        limit: 20
        window: 60s
      parameters:
        - name: sellerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Seller verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SellerProfile'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/admin/verifications/{sellerId}/reject:
    post:
      tags: [Admin]
      summary: Reject seller verification
      x-rateLimit:
        limit: 20
        window: 60s
      parameters:
        - name: sellerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  example: Document unclear
      responses:
        '200':
          description: Seller rejected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SellerProfile'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/admin/escrow:
    get:
      tags: [Admin]
      summary: Jobs awaiting fund release
      x-rateLimit:
        limit: 60
        window: 60s
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Escrow queue
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
                  meta:
                    $ref: '#/components/schemas/PageMeta'
  /v1/admin/escrow/{jobId}/release:
    post:
      tags: [Admin]
      summary: Release escrow funds to seller
      x-rateLimit:
        limit: 20
        window: 60s
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Escrow released
          content:
            application/json:
              schema:
                type: object
                properties:
                  job:
                    $ref: '#/components/schemas/Job'
                  transaction:
                    $ref: '#/components/schemas/PaymentTransaction'
        '400':
          description: Preconditions not met
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/admin/disputes:
    get:
      tags: [Admin]
      summary: Flagged jobs (disputes)
      x-rateLimit:
        limit: 60
        window: 60s
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Disputed jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
                  meta:
                    $ref: '#/components/schemas/PageMeta'
  /v1/admin/reports:
    get:
      tags: [Admin]
      summary: Financial reports
      x-rateLimit:
        limit: 30
        window: 60s
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Aggregated financial stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalDeposits:
                    type: number
                  totalPayouts:
                    type: number
                  commissionsCollected:
                    type: number
  /v1/users/me:
    get:
      tags: [Users]
      summary: Current user profile
      x-rateLimit:
        limit: 60
        window: 60s
      responses:
        '200':
          description: Profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      tags: [Users]
      summary: Update profile (including theme preference)
      x-rateLimit:
        limit: 30
        window: 60s
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                phone:
                  type: string
                address:
                  type: string
                themePreference:
                  $ref: '#/components/schemas/ThemePreferenceEnum'
              example:
                themePreference: warm-night
      responses:
        '200':
          description: Updated profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/users/me/avatar:
    post:
      tags: [Users]
      summary: Upload profile picture
      x-rateLimit:
        limit: 20
        window: 60s
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required: [file]
      responses:
        '201':
          description: Avatar uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
        '400':
          description: Validation error (size/type)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

